<% content_for :title, @compliance_framework.name %>

<div class="compliance-framework-show">
  <!-- Header Section -->
  <div class="page-header mb-8">
    <div class="flex justify-between items-start">
      <div class="flex-1">
        <div class="flex items-center space-x-3 mb-3">
          <%= link_to compliance_frameworks_path, 
              class: "text-gray-500 hover:text-gray-700" do %>
            <i class="fas fa-arrow-left mr-2"></i>Back to Frameworks
          <% end %>
          <span class="inline-flex px-3 py-1 text-sm font-semibold rounded-full 
            <%= case @compliance_framework.status
                when 'active' then 'bg-green-100 text-green-800'
                when 'inactive' then 'bg-gray-100 text-gray-800'
                when 'under_review' then 'bg-yellow-100 text-yellow-800'
                else 'bg-red-100 text-red-800'
                end %>">
            <%= @compliance_framework.status.humanize %>
          </span>
        </div>
        <h1 class="text-3xl font-bold text-gray-900"><%= @compliance_framework.name %></h1>
        <p class="text-lg text-gray-600 mt-2"><%= @compliance_framework.description %></p>
        <div class="flex items-center space-x-6 mt-4 text-sm text-gray-500">
          <span><i class="fas fa-building mr-2"></i><%= @compliance_framework.regulatory_body %></span>
          <span><i class="fas fa-university mr-2"></i><%= @compliance_framework.campus&.name || "All Campuses" %></span>
          <span><i class="fas fa-calendar mr-2"></i>Effective: <%= @compliance_framework.effective_date.strftime('%B %d, %Y') %></span>
        </div>
      </div>
      <div class="flex space-x-3">
        <%= link_to edit_compliance_framework_path(@compliance_framework), 
            class: "btn btn-outline" do %>
          <i class="fas fa-edit mr-2"></i>Edit
        <% end %>
        <%= link_to generate_report_compliance_framework_path(@compliance_framework), 
            method: :post,
            class: "btn btn-secondary" do %>
          <i class="fas fa-file-alt mr-2"></i>Generate Report
        <% end %>
        <%= link_to schedule_assessment_compliance_framework_path(@compliance_framework), 
            method: :post,
            class: "btn btn-primary" do %>
          <i class="fas fa-calendar-plus mr-2"></i>Schedule Assessment
        <% end %>
      </div>
    </div>
  </div>

  <!-- Compliance Overview Cards -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <div class="metric-card bg-white rounded-lg shadow-md p-6">
      <div class="flex items-center justify-between">
        <div>
          <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wide">Current Score</h3>
          <p class="text-3xl font-bold text-gray-900 mt-2">
            <%= number_to_percentage(@compliance_framework.current_compliance_score, precision: 1) %>
          </p>
        </div>
        <div class="p-3 rounded-full 
          <%= @compliance_framework.current_compliance_score >= 80 ? 'bg-green-100' : 
              @compliance_framework.current_compliance_score >= 60 ? 'bg-yellow-100' : 'bg-red-100' %>">
          <i class="fas fa-chart-line text-xl 
            <%= @compliance_framework.current_compliance_score >= 80 ? 'text-green-600' : 
                @compliance_framework.current_compliance_score >= 60 ? 'text-yellow-600' : 'text-red-600' %>"></i>
        </div>
      </div>
      <div class="mt-3">
        <div class="w-full bg-gray-200 rounded-full h-2">
          <div class="h-2 rounded-full 
            <%= @compliance_framework.current_compliance_score >= 80 ? 'bg-green-500' : 
                @compliance_framework.current_compliance_score >= 60 ? 'bg-yellow-500' : 'bg-red-500' %>"
               style="width: <%= @compliance_framework.current_compliance_score %>%"></div>
        </div>
      </div>
    </div>

    <div class="metric-card bg-white rounded-lg shadow-md p-6">
      <div class="flex items-center justify-between">
        <div>
          <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wide">Total Assessments</h3>
          <p class="text-3xl font-bold text-gray-900 mt-2"><%= @compliance_summary[:total_assessments] %></p>
        </div>
        <div class="p-3 bg-blue-100 rounded-full">
          <i class="fas fa-clipboard-check text-blue-600 text-xl"></i>
        </div>
      </div>
      <div class="mt-3">
        <span class="text-sm text-gray-500">
          <%= @compliance_summary[:passed_assessments] %> passed
        </span>
      </div>
    </div>

    <div class="metric-card bg-white rounded-lg shadow-md p-6">
      <div class="flex items-center justify-between">
        <div>
          <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wide">Last Assessment</h3>
          <p class="text-sm font-medium text-gray-900 mt-2">
            <% if @compliance_framework.last_assessment_date %>
              <%= time_ago_in_words(@compliance_framework.last_assessment_date) %> ago
            <% else %>
              Never assessed
            <% end %>
          </p>
        </div>
        <div class="p-3 bg-purple-100 rounded-full">
          <i class="fas fa-history text-purple-600 text-xl"></i>
        </div>
      </div>
      <div class="mt-3">
        <% if @compliance_framework.last_assessment_date %>
          <span class="text-sm text-gray-500">
            <%= @compliance_framework.last_assessment_date.strftime('%b %d, %Y') %>
          </span>
        <% end %>
      </div>
    </div>

    <div class="metric-card bg-white rounded-lg shadow-md p-6">
      <div class="flex items-center justify-between">
        <div>
          <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wide">Next Assessment</h3>
          <p class="text-sm font-medium text-gray-900 mt-2">
            <% if @compliance_summary[:next_assessment] %>
              <%= time_ago_in_words(@compliance_summary[:next_assessment]) %>
            <% else %>
              Not scheduled
            <% end %>
          </p>
        </div>
        <div class="p-3 bg-indigo-100 rounded-full">
          <i class="fas fa-calendar-alt text-indigo-600 text-xl"></i>
        </div>
      </div>
      <div class="mt-3">
        <% if @compliance_summary[:next_assessment] %>
          <span class="text-sm text-gray-500">
            <%= @compliance_summary[:next_assessment].strftime('%b %d, %Y') %>
          </span>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Main Content Grid -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Left Column: Framework Details & Requirements -->
    <div class="lg:col-span-2 space-y-8">
      <!-- Framework Details -->
      <div class="bg-white rounded-lg shadow-md">
        <div class="px-6 py-4 border-b border-gray-200">
          <h2 class="text-xl font-semibold text-gray-900">Framework Details</h2>
        </div>
        <div class="p-6">
          <dl class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <dt class="text-sm font-medium text-gray-500">Framework Version</dt>
              <dd class="mt-1 text-sm text-gray-900"><%= @compliance_framework.framework_version %></dd>
            </div>
            <div>
              <dt class="text-sm font-medium text-gray-500">Compliance Threshold</dt>
              <dd class="mt-1 text-sm text-gray-900">
                <%= number_to_percentage(@compliance_framework.compliance_threshold, precision: 1) %>
              </dd>
            </div>
            <div>
              <dt class="text-sm font-medium text-gray-500">Assessment Frequency</dt>
              <dd class="mt-1 text-sm text-gray-900">
                <%= @compliance_framework.assessment_frequency.humanize %>
              </dd>
            </div>
            <div>
              <dt class="text-sm font-medium text-gray-500">Status</dt>
              <dd class="mt-1">
                <span class="inline-flex px-2 py-1 text-xs font-medium rounded-full 
                  <%= case @compliance_framework.status
                      when 'active' then 'bg-green-100 text-green-800'
                      when 'inactive' then 'bg-gray-100 text-gray-800'
                      when 'under_review' then 'bg-yellow-100 text-yellow-800'
                      else 'bg-red-100 text-red-800'
                      end %>">
                  <%= @compliance_framework.status.humanize %>
                </span>
              </dd>
            </div>
          </dl>
        </div>
      </div>

      <!-- Requirements -->
      <% if @compliance_framework.requirements.present? %>
        <div class="bg-white rounded-lg shadow-md">
          <div class="px-6 py-4 border-b border-gray-200">
            <h2 class="text-xl font-semibold text-gray-900">Requirements</h2>
          </div>
          <div class="p-6">
            <div class="space-y-3">
              <% @compliance_framework.requirements.each_with_index do |requirement, index| %>
                <div class="flex items-start space-x-3 p-3 border border-gray-200 rounded-lg">
                  <span class="inline-flex items-center justify-center w-6 h-6 bg-blue-100 text-blue-800 text-xs font-medium rounded-full">
                    <%= index + 1 %>
                  </span>
                  <p class="text-sm text-gray-900 flex-1"><%= requirement %></p>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>

      <!-- Recent Assessments -->
      <div class="bg-white rounded-lg shadow-md">
        <div class="px-6 py-4 border-b border-gray-200">
          <div class="flex justify-between items-center">
            <h2 class="text-xl font-semibold text-gray-900">Recent Assessments</h2>
            <%= link_to "View All", compliance_framework_compliance_assessments_path(@compliance_framework), 
                class: "text-blue-600 hover:text-blue-800 text-sm font-medium" %>
          </div>
        </div>
        <div class="p-6">
          <% if @assessments.any? %>
            <div class="space-y-4">
              <% @assessments.each do |assessment| %>
                <div class="border border-gray-200 rounded-lg p-4">
                  <div class="flex items-start justify-between">
                    <div class="flex-1">
                      <div class="flex items-center space-x-3 mb-2">
                        <span class="inline-flex px-2 py-1 text-xs font-medium rounded-full 
                          <%= case assessment.status
                              when 'completed' then 'bg-green-100 text-green-800'
                              when 'in_progress' then 'bg-yellow-100 text-yellow-800'
                              when 'pending' then 'bg-gray-100 text-gray-800'
                              else 'bg-red-100 text-red-800'
                              end %>">
                          <%= assessment.status.humanize %>
                        </span>
                        <span class="text-sm text-gray-500"><%= assessment.assessment_type.humanize %></span>
                      </div>
                      <p class="text-sm font-medium text-gray-900 mb-1">
                        <%= link_to "Assessment ##{assessment.id}", 
                            [@compliance_framework, assessment], 
                            class: "hover:text-blue-600" %>
                      </p>
                      <p class="text-sm text-gray-500">
                        Assessed by <%= assessment.assessor&.name %> â€¢ 
                        <%= assessment.assessment_date.strftime('%b %d, %Y') %>
                      </p>
                    </div>
                    <% if assessment.score %>
                      <div class="text-right">
                        <p class="text-lg font-bold 
                          <%= assessment.score >= 80 ? 'text-green-600' : 
                              assessment.score >= 60 ? 'text-yellow-600' : 'text-red-600' %>">
                          <%= number_to_percentage(assessment.score, precision: 1) %>
                        </p>
                      </div>
                    <% end %>
                  </div>
                </div>
              <% end %>
            </div>
          <% else %>
            <div class="text-center py-8">
              <i class="fas fa-clipboard-check text-gray-400 text-3xl mb-3"></i>
              <p class="text-gray-500">No assessments conducted yet</p>
              <%= link_to "Schedule First Assessment", 
                  schedule_assessment_compliance_framework_path(@compliance_framework),
                  method: :post,
                  class: "btn btn-primary mt-3" %>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Right Column: Actions & Reports -->
    <div class="space-y-8">
      <!-- Quick Actions -->
      <div class="bg-white rounded-lg shadow-md">
        <div class="px-6 py-4 border-b border-gray-200">
          <h2 class="text-lg font-semibold text-gray-900">Quick Actions</h2>
        </div>
        <div class="p-6">
          <div class="space-y-3">
            <%= link_to new_compliance_framework_compliance_assessment_path(@compliance_framework), 
                class: "flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50" do %>
              <i class="fas fa-plus text-blue-600 mr-3"></i>
              <span class="text-sm font-medium text-gray-900">Schedule Assessment</span>
            <% end %>
            
            <%= link_to generate_report_compliance_framework_path(@compliance_framework), 
                method: :post,
                class: "flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50" do %>
              <i class="fas fa-file-alt text-green-600 mr-3"></i>
              <span class="text-sm font-medium text-gray-900">Generate Report</span>
            <% end %>
            
            <%= link_to compliance_framework_compliance_assessments_path(@compliance_framework), 
                class: "flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50" do %>
              <i class="fas fa-list text-purple-600 mr-3"></i>
              <span class="text-sm font-medium text-gray-900">View All Assessments</span>
            <% end %>
            
            <%= link_to export_framework_compliance_framework_path(@compliance_framework, format: :json), 
                class: "flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50" do %>
              <i class="fas fa-download text-indigo-600 mr-3"></i>
              <span class="text-sm font-medium text-gray-900">Export Framework</span>
            <% end %>
          </div>
        </div>
      </div>

      <!-- Recent Reports -->
      <div class="bg-white rounded-lg shadow-md">
        <div class="px-6 py-4 border-b border-gray-200">
          <div class="flex justify-between items-center">
            <h2 class="text-lg font-semibold text-gray-900">Recent Reports</h2>
            <%= link_to "View All", compliance_framework_compliance_reports_path(@compliance_framework), 
                class: "text-blue-600 hover:text-blue-800 text-sm font-medium" %>
          </div>
        </div>
        <div class="p-6">
          <% if @recent_reports.any? %>
            <div class="space-y-3">
              <% @recent_reports.each do |report| %>
                <div class="border border-gray-200 rounded-lg p-3">
                  <div class="flex items-center space-x-3 mb-2">
                    <span class="inline-flex px-2 py-1 text-xs font-medium rounded-full 
                      <%= case report.status
                          when 'published' then 'bg-green-100 text-green-800'
                          when 'completed' then 'bg-blue-100 text-blue-800'
                          when 'draft' then 'bg-gray-100 text-gray-800'
                          else 'bg-yellow-100 text-yellow-800'
                          end %>">
                      <%= report.status.humanize %>
                    </span>
                  </div>
                  <p class="text-sm font-medium text-gray-900 mb-1">
                    <%= link_to "#{report.report_type.humanize} Report", 
                        [@compliance_framework, report], 
                        class: "hover:text-blue-600" %>
                  </p>
                  <p class="text-xs text-gray-500"><%= report.period_description %></p>
                </div>
              <% end %>
            </div>
          <% else %>
            <div class="text-center py-6">
              <i class="fas fa-file-alt text-gray-400 text-2xl mb-2"></i>
              <p class="text-gray-500 text-sm">No reports generated yet</p>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Stakeholders -->
      <% if @compliance_framework.stakeholders.present? %>
        <div class="bg-white rounded-lg shadow-md">
          <div class="px-6 py-4 border-b border-gray-200">
            <h2 class="text-lg font-semibold text-gray-900">Stakeholders</h2>
          </div>
          <div class="p-6">
            <div class="space-y-2">
              <% @compliance_framework.stakeholders.each do |stakeholder| %>
                <div class="flex items-center space-x-2 text-sm text-gray-700">
                  <i class="fas fa-user text-gray-400"></i>
                  <span><%= stakeholder %></span>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>