<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <!-- Header -->
  <div class="mb-8">
    <div class="flex items-center justify-between">
      <div class="flex-1">
        <div class="flex items-center">
          <h1 class="text-3xl font-bold text-gray-900"><%= @assignment.title %></h1>
          <% if @assignment.overdue? %>
            <span class="ml-3 inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800">
              <svg class="mr-1 h-4 w-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
              </svg>
              Overdue
            </span>
          <% end %>
        </div>
        <div class="mt-2 flex items-center text-sm text-gray-600">
          <span class="font-medium"><%= @assignment.course_name %></span>
          <span class="mx-2">•</span>
          <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium 
            <%= case @assignment.category
                when 'homework' then 'bg-blue-100 text-blue-800'
                when 'project' then 'bg-purple-100 text-purple-800'
                when 'quiz' then 'bg-yellow-100 text-yellow-800'
                when 'exam' then 'bg-red-100 text-red-800'
                end %>">
            <%= @assignment.category.titleize %>
          </span>
          <span class="mx-2">•</span>
          <span><%= @assignment.points %> points</span>
          <span class="mx-2">•</span>
          <span>Due: <%= @assignment.due_date.strftime("%B %d, %Y at %I:%M %p") %></span>
        </div>
      </div>

      <div class="flex items-center space-x-3">
        <%= link_to assignments_path, class: "inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50" do %>
          <svg class="mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
          </svg>
          Back
        <% end %>

        <% if current_user.teacher? && @assignment.user_id == current_user.id %>
          <%= link_to edit_assignment_path(@assignment), class: "inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700" do %>
            <svg class="mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
            </svg>
            Edit
          <% end %>

          <button id="delete-btn" data-assignment-id="<%= @assignment.id %>" data-assignment-title="<%= @assignment.title %>" data-submissions-count="<%= @assignment.submissions.count %>" data-graded-count="<%= @assignment.submissions.graded.count %>" class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700">
            <svg class="mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
            </svg>
            Delete
          </button>
        <% end %>
      </div>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Main Content -->
    <div class="lg:col-span-2 space-y-6">
      <!-- Description -->
      <div class="bg-white shadow rounded-lg p-6">
        <h2 class="text-xl font-semibold text-gray-900 mb-4">Description</h2>
        <div class="prose max-w-none text-gray-700 whitespace-pre-wrap"><%= @assignment.description %></div>
      </div>

      <!-- Grading Criteria -->
      <% if @assignment.grading_criteria.present? %>
        <div class="bg-white shadow rounded-lg p-6">
          <h2 class="text-xl font-semibold text-gray-900 mb-4">Grading Criteria</h2>
          <div class="prose max-w-none text-gray-700 whitespace-pre-wrap"><%= @assignment.grading_criteria %></div>
        </div>
      <% end %>

      <!-- Attached Files -->
      <% if @assignment.files.attached? %>
        <div class="bg-white shadow rounded-lg p-6">
          <h2 class="text-xl font-semibold text-gray-900 mb-4">Attached Files</h2>
          <ul class="space-y-3">
            <% @assignment.files.each do |file| %>
              <li class="flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-200 hover:bg-gray-100 transition">
                <div class="flex items-center min-w-0 flex-1">
                  <svg class="h-8 w-8 text-gray-400 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                  </svg>
                  <div class="min-w-0 flex-1">
                    <p class="text-sm font-medium text-gray-900 truncate"><%= file.filename %></p>
                    <p class="text-xs text-gray-500 mt-1">
                      <%= number_to_human_size(file.byte_size) %> • <%= file.content_type %>
                    </p>
                  </div>
                </div>
                <%= link_to rails_blob_path(file, disposition: "attachment"), class: "ml-4 inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700" do %>
                  <svg class="mr-1 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                  </svg>
                  Download
                <% end %>
              </li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <!-- Teacher Actions -->
      <% if current_user.teacher? && @assignment.user_id == current_user.id %>
        <div class="bg-white shadow rounded-lg p-6">
          <h2 class="text-xl font-semibold text-gray-900 mb-4">Teacher Actions</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <%= link_to assignment_submissions_path(@assignment), class: "flex items-center p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition" do %>
              <svg class="h-8 w-8 text-blue-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
              </svg>
              <div>
                <div class="font-medium text-gray-900">View Submissions</div>
                <div class="text-sm text-gray-500"><%= @assignment.submissions.count %> total</div>
              </div>
            <% end %>

            <%= link_to edit_assignment_path(@assignment), class: "flex items-center p-4 border-2 border-gray-200 rounded-lg hover:border-green-500 hover:bg-green-50 transition" do %>
              <svg class="h-8 w-8 text-green-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
              </svg>
              <div>
                <div class="font-medium text-gray-900">Edit Assignment</div>
                <div class="text-sm text-gray-500">Modify details</div>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>

      <!-- Student Actions -->
      <% if current_user.student? %>
        <div class="bg-white shadow rounded-lg p-6">
          <h2 class="text-xl font-semibold text-gray-900 mb-4">Your Submission</h2>
          
          <% user_submission = @assignment.submissions.find_by(user_id: current_user.id) %>
          <% if user_submission %>
            <div class="flex items-center justify-between p-4 bg-blue-50 border border-blue-200 rounded-lg">
              <div class="flex items-center">
                <svg class="h-8 w-8 text-blue-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <div>
                  <div class="font-medium text-gray-900">Submitted</div>
                  <div class="text-sm text-gray-600">
                    <%= user_submission.submitted_at.strftime("%B %d, %Y at %I:%M %p") %>
                  </div>
                </div>
              </div>
              <%= link_to assignment_submission_path(@assignment, user_submission), class: "inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700" do %>
                View Submission
              <% end %>
            </div>
          <% else %>
            <div class="text-center py-8">
              <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
              </svg>
              <h3 class="mt-2 text-sm font-medium text-gray-900">Not Submitted</h3>
              <p class="mt-1 text-sm text-gray-500">You haven't submitted this assignment yet.</p>
              <div class="mt-6">
                <%= link_to new_assignment_submission_path(@assignment), class: "inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700" do %>
                  Submit Assignment
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>

    <!-- Sidebar -->
    <div class="lg:col-span-1 space-y-6">
      <!-- Assignment Details -->
      <div class="bg-white shadow rounded-lg p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Assignment Details</h3>
        
        <div class="space-y-4">
          <div>
            <span class="text-xs font-medium text-gray-500 uppercase block mb-1">Due Date</span>
            <div class="text-sm text-gray-900">
              <%= @assignment.due_date.strftime("%B %d, %Y") %>
              <div class="text-xs text-gray-500"><%= @assignment.due_date.strftime("%I:%M %p") %></div>
            </div>
            <% if @assignment.overdue? %>
              <div class="mt-1 text-xs text-red-600 font-medium">
                Overdue by <%= distance_of_time_in_words(@assignment.due_date, Time.current) %>
              </div>
            <% else %>
              <div class="mt-1 text-xs text-green-600 font-medium">
                Due in <%= distance_of_time_in_words(Time.current, @assignment.due_date) %>
              </div>
            <% end %>
          </div>

          <div>
            <span class="text-xs font-medium text-gray-500 uppercase block mb-1">Points</span>
            <div class="text-sm text-gray-900"><%= @assignment.points %> points</div>
          </div>

          <div>
            <span class="text-xs font-medium text-gray-500 uppercase block mb-1">Category</span>
            <div>
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium 
                <%= case @assignment.category
                    when 'homework' then 'bg-blue-100 text-blue-800'
                    when 'project' then 'bg-purple-100 text-purple-800'
                    when 'quiz' then 'bg-yellow-100 text-yellow-800'
                    when 'exam' then 'bg-red-100 text-red-800'
                    end %>">
                <%= @assignment.category.titleize %>
              </span>
            </div>
          </div>

          <div>
            <span class="text-xs font-medium text-gray-500 uppercase block mb-1">Course</span>
            <div class="text-sm text-gray-900"><%= @assignment.course_name %></div>
          </div>

          <% if @assignment.allow_resubmission %>
            <div>
              <span class="text-xs font-medium text-gray-500 uppercase block mb-1">Resubmission</span>
              <div class="flex items-center">
                <svg class="h-4 w-4 text-green-500 mr-1" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                </svg>
                <span class="text-sm text-green-700 font-medium">Allowed</span>
              </div>
            </div>
          <% end %>

          <div>
            <span class="text-xs font-medium text-gray-500 uppercase block mb-1">Created</span>
            <div class="text-sm text-gray-900">
              <%= @assignment.created_at.strftime("%B %d, %Y") %>
            </div>
          </div>
        </div>
      </div>

      <!-- Submission Statistics (Teacher Only) -->
      <% if current_user.teacher? && @assignment.user_id == current_user.id %>
        <div class="bg-white shadow rounded-lg p-6">
          <h3 class="text-lg font-semibold text-gray-900 mb-4">Submission Stats</h3>
          
          <div class="space-y-3">
            <div class="flex items-center justify-between">
              <span class="text-sm text-gray-600">Total Submissions</span>
              <span class="text-sm font-semibold text-gray-900"><%= @assignment.submissions.count %></span>
            </div>
            
            <div class="flex items-center justify-between">
              <span class="text-sm text-gray-600">Submitted</span>
              <span class="text-sm font-semibold text-green-600"><%= @assignment.submitted_count %></span>
            </div>
            
            <div class="flex items-center justify-between">
              <span class="text-sm text-gray-600">Graded</span>
              <span class="text-sm font-semibold text-purple-600"><%= @assignment.graded_count %></span>
            </div>
            
            <div class="flex items-center justify-between">
              <span class="text-sm text-gray-600">Pending</span>
              <span class="text-sm font-semibold text-yellow-600"><%= @assignment.pending_submissions_count %></span>
            </div>

            <% if @assignment.average_grade.present? %>
              <div class="pt-3 border-t border-gray-200">
                <div class="flex items-center justify-between">
                  <span class="text-sm text-gray-600">Average Grade</span>
                  <span class="text-lg font-bold text-blue-600"><%= @assignment.average_grade.round(1) %>%</span>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>

      <!-- Instructor Info -->
      <div class="bg-white shadow rounded-lg p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Instructor</h3>
        <div class="flex items-center">
          <div class="flex-shrink-0 h-10 w-10">
            <div class="h-10 w-10 rounded-full bg-blue-500 flex items-center justify-center">
              <span class="text-white font-medium text-sm">
                <%= @assignment.user.full_name.split.map(&:first).join.upcase %>
              </span>
            </div>
          </div>
          <div class="ml-3">
            <div class="text-sm font-medium text-gray-900">
              <%= @assignment.user.full_name %>
            </div>
            <div class="text-sm text-gray-500">
              <%= @assignment.user.email %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Enhanced Delete Confirmation Modal -->
<div id="delete-modal" class="hidden fixed z-10 inset-0 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
  <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
    <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>
    <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
    
    <div class="inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6">
      <div class="sm:flex sm:items-start">
        <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10">
          <svg class="h-6 w-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
          </svg>
        </div>
        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
          <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">
            Delete Assignment
          </h3>
          <div class="mt-2">
            <p class="text-sm text-gray-500">
              Are you sure you want to delete "<span id="modal-assignment-title" class="font-semibold"></span>"?
            </p>
            <div class="mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-md">
              <p class="text-sm font-medium text-yellow-800">⚠️ This action cannot be undone!</p>
              <ul class="mt-2 text-sm text-yellow-700 list-disc list-inside space-y-1">
                <li><span id="modal-submissions-count">0</span> student submission(s) will be deleted</li>
                <li><span id="modal-graded-count">0</span> graded submission(s) with feedback will be lost</li>
                <li>All attached files will be permanently removed</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <div class="mt-5 sm:mt-4 sm:flex sm:flex-row-reverse">
        <button type="button" id="confirm-delete-btn" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm">
          Delete Assignment
        </button>
        <button type="button" id="cancel-delete-btn" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:w-auto sm:text-sm">
          Cancel
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Delete Confirmation JavaScript -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const deleteBtn = document.getElementById('delete-btn');
    const deleteModal = document.getElementById('delete-modal');
    const confirmDeleteBtn = document.getElementById('confirm-delete-btn');
    const cancelDeleteBtn = document.getElementById('cancel-delete-btn');
    const modalTitle = document.getElementById('modal-assignment-title');
    const modalSubmissionsCount = document.getElementById('modal-submissions-count');
    const modalGradedCount = document.getElementById('modal-graded-count');

    if (deleteBtn) {
      deleteBtn.addEventListener('click', function() {
        const assignmentId = this.dataset.assignmentId;
        const assignmentTitle = this.dataset.assignmentTitle;
        const submissionsCount = this.dataset.submissionsCount;
        const gradedCount = this.dataset.gradedCount;

        // Update modal content
        modalTitle.textContent = assignmentTitle;
        modalSubmissionsCount.textContent = submissionsCount;
        modalGradedCount.textContent = gradedCount;

        // Store assignment ID for deletion
        confirmDeleteBtn.dataset.assignmentId = assignmentId;

        // Show modal
        deleteModal.classList.remove('hidden');
      });
    }

    if (cancelDeleteBtn) {
      cancelDeleteBtn.addEventListener('click', function() {
        deleteModal.classList.add('hidden');
      });
    }

    // Close modal when clicking outside
    deleteModal.addEventListener('click', function(e) {
      if (e.target === deleteModal) {
        deleteModal.classList.add('hidden');
      }
    });

    if (confirmDeleteBtn) {
      confirmDeleteBtn.addEventListener('click', function() {
        const assignmentId = this.dataset.assignmentId;
        
        // Create and submit delete form
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '/assignments/' + assignmentId;
        
        const methodInput = document.createElement('input');
        methodInput.type = 'hidden';
        methodInput.name = '_method';
        methodInput.value = 'delete';
        
        const csrfToken = document.querySelector('[name="csrf-token"]').content;
        const csrfInput = document.createElement('input');
        csrfInput.type = 'hidden';
        csrfInput.name = 'authenticity_token';
        csrfInput.value = csrfToken;
        
        form.appendChild(methodInput);
        form.appendChild(csrfInput);
        document.body.appendChild(form);
        form.submit();
      });
    }
  });
</script>
