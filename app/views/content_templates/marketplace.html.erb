<% content_for :title, "Template Marketplace" %>

<div class="template-marketplace">
  <!-- Hero Section -->
  <div class="marketplace-hero bg-gradient-primary text-white py-5 mb-5">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-lg-8">
          <h1 class="display-4 fw-bold mb-3">Template Marketplace</h1>
          <p class="lead mb-4">
            Discover and share educational content templates. Save time by using proven templates 
            or contribute your own to help the community.
          </p>
          <div class="d-flex gap-3">
            <%= link_to "Browse All Templates", content_templates_path, 
                        class: "btn btn-light btn-lg" %>
            <%= link_to "Create Template", new_content_template_path, 
                        class: "btn btn-outline-light btn-lg" %>
          </div>
        </div>
        <div class="col-lg-4 text-end">
          <div class="marketplace-stats">
            <div class="stat-item">
              <div class="h2 mb-0"><%= ContentTemplate.published.count %></div>
              <div class="text-light">Templates Available</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="container">
    <!-- Quick Search -->
    <div class="row mb-5">
      <div class="col-12">
        <div class="search-section bg-light rounded-4 p-4">
          <%= form_with url: search_content_templates_path, method: :get, 
                        class: "d-flex gap-3 align-items-end", local: true do |form| %>
            <div class="flex-grow-1">
              <%= form.text_field :q, placeholder: "Search templates...", 
                                  class: "form-control form-control-lg",
                                  value: params[:q] %>
            </div>
            <div>
              <%= form.select :type, options_for_select([
                    ['All Types', ''],
                    ['Assignment', 'assignment'],
                    ['Quiz', 'quiz'], 
                    ['Note', 'note']
                  ], params[:type]), 
                  {}, { class: "form-select" } %>
            </div>
            <div>
              <%= form.select :category, options_for_select([
                    ['All Categories', '']
                  ] + @categories.map { |cat| [cat.humanize, cat] }, params[:category]), 
                  {}, { class: "form-select" } %>
            </div>
            <div>
              <%= form.submit "Search", class: "btn btn-primary btn-lg" %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
    
    <!-- Featured Templates -->
    <% if @featured_templates.any? %>
      <section class="mb-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2 class="h3 mb-0">
            <i class="bi bi-star-fill text-warning me-2"></i>
            Featured Templates
          </h2>  
          <%= link_to "View All", content_templates_path(featured: true), 
                      class: "btn btn-outline-primary" %>
        </div>
        
        <div class="row">
          <% @featured_templates.each do |template| %>
            <div class="col-md-6 col-lg-4 mb-4">
              <%= render 'template_card', template: template, featured: true %>
            </div>
          <% end %>
        </div>
      </section>
    <% end %>
    
    <!-- Popular Templates -->
    <% if @popular_templates.any? %>
      <section class="mb-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2 class="h3 mb-0">
            <i class="bi bi-fire text-danger me-2"></i>
            Popular Templates
          </h2>
          <%= link_to "View All", content_templates_path(sort: 'popular'), 
                      class: "btn btn-outline-primary" %>
        </div>
        
        <div class="row">
          <% @popular_templates.each do |template| %>
            <div class="col-md-6 col-lg-3 mb-4">
              <%= render 'template_card', template: template %>
            </div>
          <% end %>
        </div>
      </section>
    <% end %>
    
    <!-- Trending Templates -->
    <% if @trending_templates.any? %>
      <section class="mb-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2 class="h3 mb-0">
            <i class="bi bi-trending-up text-success me-2"></i>
            Trending This Week
          </h2>
          <%= link_to "View All", content_templates_path(sort: 'trending'), 
                      class: "btn btn-outline-primary" %>
        </div>
        
        <div class="row">
          <% @trending_templates.each do |template| %>
            <div class="col-md-6 col-lg-3 mb-4">
              <%= render 'template_card', template: template, trending: true %>
            </div>
          <% end %>
        </div>
      </section>
    <% end %>
    
    <!-- My Favorites -->
    <% if @my_favorites.any? %>
      <section class="mb-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2 class="h3 mb-0">
            <i class="bi bi-heart-fill text-danger me-2"></i>
            My Favorites
          </h2>
          <%= link_to "View All", favorites_content_templates_path, 
                      class: "btn btn-outline-primary" %>
        </div>
        
        <div class="row">
          <% @my_favorites.each do |template| %>
            <div class="col-md-6 col-lg-3 mb-4">
              <%= render 'template_card', template: template %>
            </div>
          <% end %>
        </div>
      </section>
    <% end %>
    
    <!-- Recent Templates -->
    <% if @recent_templates.any? %>
      <section class="mb-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2 class="h3 mb-0">
            <i class="bi bi-clock text-info me-2"></i>
            Recently Added
          </h2>
          <%= link_to "View All", content_templates_path(sort: 'recent'), 
                      class: "btn btn-outline-primary" %>
        </div>
        
        <div class="row">
          <% @recent_templates.each do |template| %>
            <div class="col-md-6 col-lg-3 mb-4">
              <%= render 'template_card', template: template %>
            </div>
          <% end %>
        </div>
      </section>
    <% end %>
    
    <!-- Categories -->
    <section class="mb-5">
      <h2 class="h3 mb-4">Browse by Category</h2>
      <div class="row">
        <% @categories.each do |category| %>
          <div class="col-md-6 col-lg-3 mb-3">
            <%= link_to content_templates_path(category: category), 
                        class: "card category-card h-100 text-decoration-none" do %>
              <div class="card-body text-center">
                <i class="bi bi-folder-fill fs-1 text-primary mb-3"></i>
                <h5 class="card-title"><%= category.humanize %></h5>
                <p class="card-text text-muted">
                  <%= ContentTemplate.published.by_category(category).count %> templates
                </p>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>
    </section>
    
    <!-- Call to Action -->
    <section class="text-center py-5 bg-light rounded-4 mb-5">
      <h2 class="h3 mb-3">Share Your Templates</h2>
      <p class="lead text-muted mb-4">
        Help other educators by sharing your best content templates. 
        Build your reputation and contribute to the community.
      </p>
      <div class="d-flex justify-content-center gap-3">
        <%= link_to "Create Template", new_content_template_path, 
                    class: "btn btn-primary btn-lg" %>
        <%= link_to "View My Templates", my_templates_content_templates_path, 
                    class: "btn btn-outline-primary btn-lg" %>
      </div>
    </section>
  </div>
</div>

<style>
.marketplace-hero {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.marketplace-stats .stat-item {
  text-align: center;
  padding: 1rem;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 1rem;
  backdrop-filter: blur(10px);
}

.category-card {
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  border: 1px solid #e2e8f0;
}

.category-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
  text-decoration: none;
}

.search-section {
  border: 1px solid #e2e8f0;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

@media (max-width: 768px) {
  .marketplace-hero .display-4 {
    font-size: 2rem;
  }
  
  .search-section .d-flex {
    flex-direction: column;
    gap: 1rem !important;
  }
  
  .search-section .d-flex > div {
    width: 100%;
  }
}
</style>