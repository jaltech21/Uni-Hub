#!/usr/bin/env ruby
# frozen_string_literal: true

# Test quiz generation with Gemini
require_relative '../config/environment'

puts "=" * 60
puts "GEMINI QUIZ GENERATION TEST"
puts "=" * 60
puts

test_text = <<~TEXT
  Entity-Relationship Model (ERM) is a conceptual data model used in database design.
  It represents real-world entities and the relationships between them.
  
  Key components include:
  - Entities: Objects or things in the real world (e.g., Student, Course)
  - Attributes: Properties of entities (e.g., student name, course code)
  - Relationships: Associations between entities (e.g., Student enrolls in Course)
  
  ERM uses diagrams with rectangles for entities, ovals for attributes, and diamonds for relationships.
TEXT

puts "üìù Test Text: #{test_text[0..100]}..."
puts "üîß Provider: #{ENV['AI_PROVIDER']}"
puts

begin
  puts "üöÄ Generating quiz questions..."
  provider = AiServiceFactory.provider
  
  result = provider.generate_questions(
    test_text,
    question_type: :multiple_choice,
    count: 3,
    difficulty: :medium,
    user_id: 1
  )
  
  if result[:success]
    puts "‚úÖ SUCCESS!"
    puts
    puts "üìä Generated #{result[:questions].length} questions:"
    puts
    
    result[:questions].each_with_index do |q, i|
      puts "Question #{i + 1}:"
      puts "  Type: #{q[:type]}"
      puts "  Q: #{q[:question]}"
      puts "  Options: #{q[:options].inspect}"
      puts "  Correct: #{q[:correct_answer]}"
      puts "  Explanation: #{q[:explanation]}"
      puts
    end
    
    puts "‚è±Ô∏è  Processing Time: #{result[:processing_time]}s"
    puts "üéØ Tokens Used: #{result[:tokens_used]}"
  else
    puts "‚ùå FAILED!"
    puts
    puts "Error: #{result[:error]}"
  end
rescue StandardError => e
  puts "‚ùå EXCEPTION!"
  puts
  puts "Error: #{e.class.name}"
  puts "Message: #{e.message}"
  puts
  puts "Backtrace:"
  puts e.backtrace.first(10).join("\n")
end

puts
puts "=" * 60
